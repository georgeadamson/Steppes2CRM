<%

	# Important:
	# - client.shortname is derived client-side if not present in these results.
	# - Client-side script assumes all fields are never 'undefined' or 'null'. They must always be a string.

	matched_clients	= []

	@clients.each do |client|

		# Client hash:
		client_data = {

      :id					=> client.id,
      :title			=> client.title				|| '',
      :name				=> client.name				|| '',		# AKA surname
      :forename		=> client.forename		|| '',
      :email1			=> client.email1			|| '',
      :email2			=> client.email2			|| '',
			#:shortname	=> "#{ client.title } #{ client.forename.slice(0,1) } #{ client.name }",	# shortname is derived cl

			:address		=> {
				:address1		=> client.address1	|| '',
				:address2		=> client.address2	|| '',
				:address3		=> client.address3	|| '',
				:address4		=> client.address4	|| '',
				:address5		=> client.address5	|| '',
				:postcode		=> client.postcode	|| '',
				:country		=> client.country		|| ''
			},

			:trips_statement	=> client.trips_statement || ''

		}

		# Append this client hash to the array of results:
		matched_clients << client_data

	end

	return matched_clients.to_json

%><%#=

#  @clients.to_json({
#    
#    # @clients variable contains any clients matching the search criteria.
#    # To reduce bloat we specify explicitly which fields to include in the json:
#
#    # List properties generated by datamapper:
#    :only => [
#      :id,
#      :name,		# AKA surname
#      :forename,
#      :email1,
#      :email2
#    ],
#
#    # Any non-datamapper properties need to be handled differently:
#    :methods => [
#      :fullname,
#      :shortname,
#      :search_results_address
#			#:trips_statement
#      #:trips_lite	# trips_lite is a custom minimal alternative to the full trips collection.
#      #:client_addresses
#      #:address1,
#      #:address2,
#      #:address3,
#      #:address4,
#      #:address5,
#      #:postcode
#    ]
#		,
#    
#    :relationships => {
#
#			:trips => {
#
#				:only => [
#					:id,
#					:name,
#					:start_date,
#					:type_id,
#					:status_id,
#					:travellers
#				],
#
#				:methods => [
#					:first_version_name
#					#:countries
#					#:type,
#					#:status,
#					#:clients
#				]
#
#			}
#
#		}
#  })

%>