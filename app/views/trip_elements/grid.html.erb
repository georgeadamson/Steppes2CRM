<%

	@elements	= @elements.all( :type_id => TripElementType::FLIGHT )
	@trip     = @elements.first && @elements.first.trip || Trip.get(params[:trip_id])
	
	airports	= Airport.all( Airport.country.companies.id => @trip.company_id.to_s, :order => [:code,:name] )
	airports.reload
	
	field_prefix = 'trip[trip_elements_attributes]'
	
%>

<div style="padding:2em;background-color:#000;-moz-box-shadow:5px 5px 10px #000;height:25em;margin:2em;overflow-y:auto;">

	<%= form_for @trip, :action => nested_resource(@client_or_tour, @trip) do %>
		
	<table id="trip-elements-grid" cellspacing="0" cellpadding="0">

		<thead>
			<tr>
				<th colspan="1"></th>
				<th colspan="1">Flight</th>
				<th colspan="3">Depart</th>
				<th colspan="3">Arrive</th>
				<!--<th colspan="1">Supplier</th>-->
				<!--<th colspan="1">Agent</th>-->
			</tr>
		</thead>
		
		<tbody>

			<% @elements.each_with_index do |trip_element,i| %>

				<%= partial 'trip_elements/grid_row', :trip_element => trip_element, :field_index => i, :field_prefix => field_prefix %>

			<% end %>

			<!-- BLANK ROW for adding flights: (Also used as template for each new row) -->
			<script type="text/html" id="trip-elements-grid-row-template">
				<%= partial 'trip_elements/grid_row', :trip_element => @trip.flights.new, :field_index => :new, :field_prefix => field_prefix %>
			</script>

		</tbody>

	</table>

	<% end =%>

</div>

	<textarea id="amadeus-paste">Paste Amadeus text here to add flights...</textarea>

<style type="text/css">

	#trip-elements-grid THEAD TH { color:#fff; }

	#trip-elements-grid TBODY TD { padding:0 0.2em 0 0; }


	TABLE#trip-elements-grid { background-color:#000; }

	#trip-elements-grid TBODY TD,
	#trip-elements-grid TBODY TD .formField INPUT,
	#trip-elements-grid TBODY TD .formField SELECT {
		background-color:transparent;
		color:yellow;
		font-family:"Lucida Sans Unicode","Lucida Grande",monospace;
		outline:medium none;
	}
	
	#trip-elements-grid TBODY TD .formField INPUT:focus,
	#trip-elements-grid TBODY TD .formField SELECT:focus {
		background-color:#fff;
		color:#000;
	}
		
	#trip-elements-grid TBODY TD:nth-child(1) { padding-right:1em; }
	#trip-elements-grid TBODY TD:nth-child(5) { padding-right:2em; }

	#trip-elements-grid .formField { min-height:auto; padding:0.1em; }
	
	#trip-elements-grid .formField LABEL { display:none; }

	#trip-elements-grid .formField SELECT { height:1.5em; }
	
	#trip-elements-grid .formField INPUT.date  { width:8em; }
	#trip-elements-grid .formField INPUT.time  { width:3em; }
	
	#trip-elements-grid .formField .widthHalfField { margin-right:0; }
	
	/* Use 'clip' to hide dropdown-arrow until user hovers or focuses on it: */
	#trip-elements-grid .formField.airport { position:relative; top:0.8em; height:1.5em; width:4.8em; }
	#trip-elements-grid .formField SELECT.airport { position:absolute; clip:rect(auto,2.35em,auto,auto); width:3.8em; }
	#trip-elements-grid .formField SELECT.airport:hover,
	#trip-elements-grid .formField SELECT.airport:focus { clip:rect(auto,auto,auto,auto); }
	
	#trip-elements-grid .formField SELECT.airport OPTION:first-child { color:#f00; }

	/* BUTTONS: */
	#trip-elements-grid               .delete { visibility:hidden; }
	#trip-elements-grid               .add    { visibility:hidden; }
	#trip-elements-grid TR:last-child .add    { visibility:visible; }
	
	
	/* PASTE AMADEUAS TEXT: */
	#amadeus-paste {
		background:#fff url(images/icons/icon.amadeus.a.medium.gif) no-repeat right top;
		font-family:"Lucida Sans Unicode","Lucida Grande",monospace;
		margin-top:2em;
		width:100%;
	}
	
</style>