<%

	@elements	= @elements.all( :type_id => TripElementType::FLIGHT )
	
	airports	= Airport.all(  Airport.country.companies.id => @trip.company_id.to_s, :order => [:code,:name] )
	airports.reload
	
%>

<div style="padding:2em;background-color:#000;">

	<table id="trip-elements-grid" cellspacing="0" cellpadding="0">

		<thead>
			<tr>
				<th colspan="1"></th>
				<th colspan="1">Flight</th>
				<th colspan="3">Depart</th>
				<th colspan="3">Arrive</th>
				<th colspan="1">Supplier</th>
				<th colspan="1">Agent</th>
			</tr>
		</thead>
		
		<tbody>

			<% @elements.each do |element| %>
			
				<%= fields_for element do %>
				<tr>

					<td>
						<%= icon :flight     %>
						<%= hidden_field :id %>
					</td>
					<td>
						<%= text_field :flight_code, :class => 'widthHalfField', :title => 'Flight number' if element.flight? %>
					</td>

					<td>
						<%= select :depart_airport_id, :selected => element.depart_airport_id.to_s, :collection => airports.all(:id=>element.depart_airport_id), :disabled => element.bound_to_pnr?, :readonly => element.bound_to_pnr?, :value_method => :id, :text_method => :display_code, :class => 'airport widthHalfField', :prompt => '---  Choose', :title => 'Departure airport' if element.flight? %>
					</td>
					<td>
					<%= text_field :start_date, :value => element.start_date.formatted(:uidate), :class => 'date', :title => 'Departure date' %>
					</td>
					<td>
						<%= text_field :start_date, :value => element.start_date.formatted(:uitime), :class => 'time widthHalfField', :title => 'Departure time' %>
					</td>

					<td>
						<%= select :arrive_airport_id, :selected => element.arrive_airport_id.to_s, :collection => airports.all(:id=>element.arrive_airport_id), :disabled => element.bound_to_pnr?, :readonly => element.bound_to_pnr?, :value_method => :id, :text_method => :display_code, :class => 'airport widthHalfField', :prompt => '---  Choose', :title => 'Arrival airport' if element.flight? %>
					</td>
					<td>
						<%= text_field :end_date,   :value => element.end_date.formatted(:uidate), :class => 'date', :title => 'Arrival date' %>
					</td>
					<td>
						<%= text_field :end_date,   :value => element.end_date.formatted(:uitime), :class => 'time widthHalfField', :title => 'Arrival time' %>
					</td>

				</tr>
				<% end =%>

			<% end %>

				<!-- Blank row for adding flights: (Also used as template for each new row) -->
				<tr>

					<td>
						<%= icon :add %>
					</td>
					<td>
						<%= text_field	:name => :flight_code, :class => 'widthHalfField', :title => 'Flight number' %>
					</td>

					<td>
						<%= select			:name => :depart_airport_id, :collection => airports.all, :value_method => :id, :text_method => :display_code, :class => 'airport widthHalfField', :prompt => '---  Choose', :title => 'Departure airport' %>
					</td>
					<td>
					<%= text_field		:name => :start_date, :value => Time.now.formatted(:uidate), :class => 'date', :title => 'Departure date' %>
					</td>
					<td>
						<%= text_field	:name => :start_date, :value => Time.now.formatted(:uitime), :class => 'time widthHalfField', :title => 'Departure time' %>
					</td>

					<td>
						<%= select			:name => :arrive_airport_id, :collection => airports.all, :value_method => :id, :text_method => :display_code, :class => 'airport widthHalfField', :prompt => '---  Choose', :title => 'Arrival airport' %>
					</td>
					<td>
						<%= text_field	:name => :end_date,   :value => Time.now.formatted(:uidate), :class => 'date', :title => 'Arrival date' %>
					</td>
					<td>
						<%= text_field	:name => :end_date,   :value => Time.now.formatted(:uitime), :class => 'time widthHalfField', :title => 'Arrival time' %>
					</td>

				</tr>

		</tbody>

	</table>

	<textarea id="amadeus-paste">Paste Amadeus text here to add flights...</textarea>

</div>

<style type="text/css">

	#trip-elements-grid THEAD TH { color:#fff; }

	#trip-elements-grid TBODY TD { padding:0 0.2em 0 0; }


	TABLE#trip-elements-grid { background-color:#000; }

	#trip-elements-grid TBODY TD,
	#trip-elements-grid TBODY TD .formField INPUT,
	#trip-elements-grid TBODY TD .formField SELECT {
		background-color:transparent;
		color:yellow;
		font-family:"Lucida Sans Unicode","Lucida Grande",monospace;
		outline:medium none;
	}
	
	#trip-elements-grid TBODY TD .formField INPUT:focus,
	#trip-elements-grid TBODY TD .formField SELECT:focus {
		background-color:#fff;
		color:#000;
	}
		
	#trip-elements-grid TBODY TD:nth-child(1) { padding-right:1em; }
	#trip-elements-grid TBODY TD:nth-child(5) { padding-right:2em; }

	#trip-elements-grid .formField { min-height:auto; padding:0.1em; }
	
	#trip-elements-grid .formField LABEL { display:none; }

	#trip-elements-grid .formField SELECT { height:1.5em; }
	
	#trip-elements-grid .formField INPUT.date  { width:8em; }
	#trip-elements-grid .formField INPUT.time  { width:3em; }
	
	#trip-elements-grid .formField .widthHalfField { margin-right:0; }
	
	/* Use 'clip' to hide dropdown-arrow until user hovers or focuses on it: */
	#trip-elements-grid .formField.airport { position:relative; top:0.8em; height:1.5em; width:4.8em; }
	#trip-elements-grid .formField SELECT.airport { position:absolute; clip:rect(auto,2.35em,auto,auto); width:3.8em; }
	#trip-elements-grid .formField SELECT.airport:hover,
	#trip-elements-grid .formField SELECT.airport:focus { clip:rect(auto,auto,auto,auto); }
	
	#trip-elements-grid .formField SELECT.airport OPTION:first-child { color:#f00; }
	
	#amadeus-paste {
		background:#fff url(images/icons/icon.amadeus.a.medium.gif) no-repeat right top;
		font-family:"Lucida Sans Unicode","Lucida Grande",monospace;
		margin-top:2em;
		width:100%;
	}
	
</style>